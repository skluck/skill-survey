<!doctype html>
<html data-framework="vue">
    <head>
        <meta charset="utf-8">
        <title>Skill Survey â€¢ Vue.js</title>

        <link rel="stylesheet" href="https://unpkg.com/semantic-ui@2.2.4/dist/semantic.min.css"/>
        <link rel="stylesheet" href="utilities.css"/>
        <script src="https://unpkg.com/jquery@3.1.0/dist/jquery.min.js"></script>
        <script src="https://unpkg.com/semantic-ui@2.2.4/dist/semantic.min.js"></script>

        <script src="https://unpkg.com/vue@2.0.0-rc.6/dist/vue.js"></script>
        <script src="https://unpkg.com/vue-resource@1.0.2/dist/vue-resource.js"></script>

        <style>
            .ui.sticky.bound.bottom {
                margin-bottom: 1em;
            }
            .ui.sticky.bound.bottom + div {
                margin-bottom: 2.5em;
            }
        </style>
    </head>
    <body>
        <div class="ui container my-3" id="ss-app">
            <navigation
                v-on:load-survey="fetchData"
                v-on:clear-survey="clearData"
                :sections="sections"
                v-model="source"></navigation>

            <message
                negative="1"
                :value="last_message"></message>

            <template v-if="sections">
                <template v-for="(section, section_id) in sections">
                    <div class="ui basic segment">

                        <div class="ui bound top sticky" v-sticky>
                            <div class="ui blue inverted clearing segment">
                                <button class="ui mini icon button position-absolute" @click="toggleSection(section_id)">
                                    <i class="toggle icon" v-bind:class="{ on: section.show_section, off: !section.show_section }"></i>
                                </button>

                                <div class="ui teal progress my-0 float-right w-20">
                                    <div class="bar" v-bind:style="survey_progress_style">
                                        <div class="progress">{{ survey_progress }}%</div>
                                    </div>
                                    <div class="label top-0 text-trans">Survey</div>
                                </div>

                                <div class="ui green progress my-0 mx-2 float-right w-30">
                                    <div class="bar" v-bind:style="section.progress_style">
                                        <div class="progress">{{ section.progress }}%</div>
                                    </div>
                                    <div class="label top-0 text-trans">Section</div>
                                </div>

                                <h2 class="mt-0 pl-5">{{ section.name }}</h2>
                            </div>
                        </div>

                        <div v-show="section.show_section">
                            <div class="ui divided items">
                                <template v-for="(comp, comp_title) in section.competencies">
                                    <competency
                                        v-on:set-competency="saveRating(section_id, comp_title, $event)"
                                        :comp="comp"
                                        :comp_title="comp_title"
                                        :categories="categories"
                                        :ratings="ratings"
                                        :unratings="unratings"
                                    ></competency>
                                </template>
                            </div>
                        </div>

                    </div>
                </template>
            </template>

            <template v-else>
                <message
                negative="0"
                header="What is this?"
                value="There is no survey currently loaded. Load a survey with the toolbar at the top of the page."></message>

                <categories :categories="categories"></categories>
                <ratings :ratings="ratings" :unratings="unratings"></ratings>
            </template>
        </div>

        <script type="text/x-template" id="ss-navigation">
            <div class="ui massive stackable icon menu">
                <div class="header item">Skill Evaluation and Competencies</div>

                <a class="item" href="https://github.com/skluck/skill-survey"><i class="large github icon"></i></a>

                <div class="right menu">
                    <div class="item">
                        <div v-if="!sections" class="ui action mini input">
                            <input class="ui mini field" type="text" v-bind:value="value" v-on:input="onInput">
                            <button type="button" class="ui primary button" @click="loadSurvey">Load Survey</button>
                        </div>
                        <div v-else class="ui mini input">
                            <button type="button" class="ui basic negative button" @click="clearSurvey">Unload Survey</button>
                        </div>
                    </div>
                </div>
            </div>
        </script>

        <script type="text/x-template" id="ss-message">
            <div v-if="value" class="ui icon message" :class="tone">
                <i class="icon" :class="icon"></i>
                <div class="content">
                    <template v-if="header">
                        <div class="header">{{ header }}</div>
                    </template>
                    <p>{{ value }}</p>
                </div>
            </div>
        </script>

        <script type="text/x-template" id="ss-categories">
            <div v-if="categories" class="ui segments mt-5">
                <h2 class="ui top attached block header">Categories</h2>
                <div class="ui segment" v-for="category in categories">
                    <span :class="category.style" class="ui ribbon basic label">{{ category.name }}</span>
                    {{ category.description }}
                </div>
            </div>
        </script>

        <script type="text/x-template" id="ss-ratings">
            <div v-if="ratings" class="ui segments my-5">
                <h2 class="ui top attached block header">Ratings</h2>

                <div class="ui segment" v-for="rating in ratings">
                    <span class="ui grey ribbon label">{{ rating.value }}</span>
                    {{ rating.human }}
                </div>

                <div v-if="unratings" class="ui grey segment">
                    <h5 class="ui">Cannot Evaluate?</h5>

                    <p v-for="rating in unratings">
                        <span class="ui basic grey inverted ribbon label">{{ rating.value }}</span>
                        <span v-if="rating.warning" class="ui left basic red label"><i class="warning icon"></i>{{ rating.tip }}</span>
                        {{ rating.extended }}
                    </p>
                </div>
            </div>
        </script>

        <script type="text/x-template" id="ss-category">
            <span>
                <template v-for="category in categories">
                    <b v-if="selected_category == category.name" class="ui basic label" :class="category.style">{{ category.name }}</b>
                </template>
            </span>
        </script>

        <script type="text/x-template" id="ss-competency">
            <div class="ui item stackable grid pb-0">
                <div class="ui three wide column">
                    <div v-if="comp.rating === ''" class="ui label">{{ comp_title }}</div>
                    <div v-else class="ui green label position-relative">
                        <template v-if="comp.rating !== ''">
                            <span v-if="unrating_values.includes(comp.rating)" class="ui floating basic black circular mini label">{{ comp.rating }}</span>
                            <span v-else class="ui floating black circular mini label">{{ comp.rating }}</span>
                            {{ comp_title }}
                        </template>
                    </div>

                    <category :categories="categories" :selected_category="comp.category"></category>
                </div>
                <div class="ui thirteen wide column stackable grid">

                    <div class="ui row">
                        <div class="ui eleven wide column">
                            <h3>{{ comp.competency }}</h3>
                        </div>
                        <div class="ui five wide column">
                            <template v-if="comp.rating === ''">
                                <template v-for="rating in unratings">
                                    <label class="ui compact mini basic button right floated"
                                        @click="onChange(rating.value)"
                                        :data-tooltip="rating.tip"
                                        data-position="bottom center"
                                        @mouseover="hoverRating"
                                        @mouseout="hoverRatingOff">
                                        {{ rating.human }}
                                    </label>
                                </template>
                            </template>
                            <template v-else>
                                <label class="ui compact mini negative basic button right floated" @click="onChange('')">
                                    Clear
                                </label>
                            </template>
                        </div>
                    </div>

                    <template v-if="comp.rating === ''">
                        <div class="ui">
                            <div class="ui items">
                                <div class="item" v-for="rating in ratings">
                                    <label class="ui compact small message"
                                        @click="onChange(rating.value)"
                                        @mouseover="hoverRating"
                                        @mouseout="hoverRatingOff">
                                        <b class="ui label">{{ rating.value }}</b>
                                        {{ comp.examples[rating.value] }}
                                    </label>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </script>

        <script src="app.js"></script>
    </body>
</html>
